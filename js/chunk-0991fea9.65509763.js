(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0991fea9"],{1452:function(t,e,r){},6887:function(t,e,r){"use strict";r("1452")},"7db0":function(t,e,r){"use strict";var a=r("23e7"),n=r("b727").find,s=r("44d2"),i="find",o=!0;i in[]&&Array(1)[i]((function(){o=!1})),a({target:"Array",proto:!0,forced:o},{find:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),s(i)},ad68:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"container py-5"},[t.isLoading?r("Spinner"):[r("RestaurantDetail",{attrs:{"initial-restaurant":t.restaurant}}),r("RestaurantComments",{attrs:{"initial-restaurant-comments":t.restaurantComments},on:{"after-delete-comment":t.afterDeleteComment}}),r("CreateComment",{attrs:{"restaurant-id":t.restaurant.id},on:{"after-create-comment":t.afterCreateComment}})]],2)},n=[],s=r("1da1"),i=r("5530"),o=(r("96cf"),r("b0c0"),r("a4d3"),r("e01a"),r("4de4"),r("d3b7"),function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"row"},[r("div",{staticClass:"col-md-12 mb-3"},[r("h1",[t._v(" "+t._s(t.restaurant.name)+" ")]),r("p",{staticClass:"badge bg-secondary mt-1 mb-3"},[t._v(" "+t._s(t.restaurant.categoryName)+" ")])]),r("div",{staticClass:"col-lg-4"},[r("img",{staticClass:"img-fluid d-block mx-auto",staticStyle:{width:"250px","margin-bottom":"25px"},attrs:{src:t._f("emptyImage")(t.restaurant.image)}}),r("div",{staticClass:"contact-info-wrap"},[r("ul",{staticClass:"list-unstyled"},[r("li",[r("strong",[t._v("Opening Hour:")]),t._v(" "+t._s(t.restaurant.openingHours)+" ")]),r("li",[r("strong",[t._v("Tel:")]),t._v(" "+t._s(t.restaurant.tel)+" ")]),r("li",[r("strong",[t._v("Address:")]),t._v(" "+t._s(t.restaurant.address)+" ")])])])]),r("div",{staticClass:"col-lg-8"},[r("p",[t._v(" "+t._s(t.restaurant.description)+" ")]),r("router-link",{staticClass:"btn btn-primary btn-border me-2",attrs:{to:{name:"restaurant-dashboard",params:{id:t.restaurant.id}}}},[t._v(" Dashboard ")]),t.restaurant.isFavorited?r("button",{staticClass:"btn btn-danger btn-border me-2",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.deleteFromFavorite(t.restaurant.id)}}},[t._v(" 移除最愛 ")]):r("button",{staticClass:"btn btn-primary btn-border me-2",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.addToFavorite(t.restaurant.id)}}},[t._v(" 加到最愛 ")]),t.restaurant.isLiked?r("button",{staticClass:"btn btn-danger like me-2",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.deleteFromLike(t.restaurant.id)}}},[t._v(" Unlike ")]):r("button",{staticClass:"btn btn-primary like me-2",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.addToLike(t.restaurant.id)}}},[t._v(" Like ")])],1)])}),c=[],u=r("57f1"),d=r("4cce"),m=r("b132"),l={name:"RestaurantDetail",mixins:[u["a"]],props:{initialRestaurant:{type:Object,required:!0}},data:function(){return{restaurant:{}}},watch:{initialRestaurant:function(t){this.restaurant=Object(i["a"])(Object(i["a"])({},this.restaurant),t)}},methods:{addToFavorite:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,d["a"].addToFavorite({restaurantId:t});case 3:if(a=r.sent,n=a.data,"success"===n.status){r.next=7;break}throw new Error(n.message);case 7:e.restaurant=Object(i["a"])(Object(i["a"])({},e.restaurant),{},{isFavorited:!0}),r.next=13;break;case 10:r.prev=10,r.t0=r["catch"](0),m["a"].fire({icon:"error",title:"無法新增餐廳到最愛，請稍後再試"});case 13:case"end":return r.stop()}}),r,null,[[0,10]])})))()},deleteFromFavorite:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,d["a"].deleteFromFavorite({restaurantId:t});case 3:if(a=r.sent,n=a.data,"success"===n.status){r.next=7;break}throw new Error(n.message);case 7:e.restaurant=Object(i["a"])(Object(i["a"])({},e.restaurant),{},{isFavorited:!1}),r.next=13;break;case 10:r.prev=10,r.t0=r["catch"](0),m["a"].fire({icon:"error",title:"無法從最愛刪除餐廳，請稍後再試"});case 13:case"end":return r.stop()}}),r,null,[[0,10]])})))()},addToLike:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,d["a"].addToLike({restaurantId:t});case 3:if(a=r.sent,n=a.data,"success"===n.status){r.next=7;break}throw new Error(n.message);case 7:e.restaurant=Object(i["a"])(Object(i["a"])({},e.restaurant),{},{isLiked:!0}),r.next=13;break;case 10:r.prev=10,r.t0=r["catch"](0),m["a"].fire({icon:"error",title:"無法新增餐廳到喜愛，請稍後再試"});case 13:case"end":return r.stop()}}),r,null,[[0,10]])})))()},deleteFromLike:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,d["a"].deleteFromLike({restaurantId:t});case 3:if(a=r.sent,n=a.data,"success"===n.status){r.next=7;break}throw new Error(n.message);case 7:e.restaurant=Object(i["a"])(Object(i["a"])({},e.restaurant),{},{isLiked:!1}),r.next=13;break;case 10:r.prev=10,r.t0=r["catch"](0),m["a"].fire({icon:"error",title:"無法從喜愛將餐廳刪除，請稍後再試"});case 13:case"end":return r.stop()}}),r,null,[[0,10]])})))()}}},f=l,p=(r("e09a"),r("2877")),b=Object(p["a"])(f,o,c,!1,null,"dfa9ca10",null),v=b.exports,g=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("h2",{staticClass:"my-4"},[t._v(" 所有評論： ")]),t._l(t.restaurantComments,(function(e){return r("div",{key:e.id},[r("blockquote",{staticClass:"blockquote mb-0"},[t.currentUser.isAdmin?r("button",{staticClass:"btn btn-danger float-end",attrs:{type:"button",disabled:e.isProcessing},on:{click:function(r){return r.stopPropagation(),r.preventDefault(),t.handleDeleteButtonClick(e.id)}}},[t._v(" Delete ")]):t._e(),r("h3",[r("router-link",{staticClass:"text-decoration-none",attrs:{to:{name:"user",params:{id:e.User.id}},href:"#"}},[t._v(" "+t._s(e.User.name)+" ")])],1),r("p",[t._v(" "+t._s(e.text)+" ")]),r("footer",{staticClass:"blockquote-footer"},[t._v(" "+t._s(t._f("fromNow")(e.createdAt))+" ")])]),r("hr")])}))],2)},h=[],x=(r("d81d"),r("7db0"),r("4940")),k=r("2f62"),C={create:function(t){var e=t.text,r=t.restaurantId;return m["b"].post("/comments",{text:e,restaurantId:r})},delete:function(t){var e=t.commentId;return m["b"].delete("/comments/".concat(e))}},w={name:"RestaurantComments",mixins:[x["a"]],props:{initialRestaurantComments:{type:Array,required:!0}},data:function(){return{restaurantComments:[]}},computed:Object(i["a"])({},Object(k["b"])(["currentUser"])),watch:{initialRestaurantComments:function(t){this.restaurantComments=t.map((function(t){return Object(i["a"])(Object(i["a"])({},t),{},{isProcessing:!1})}))}},methods:{handleDeleteButtonClick:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=e.restaurantComments.find((function(e){return e.id===t})),r.prev=1,a.isProcessing=!0,r.next=5,C.delete({commentId:t});case 5:if(n=r.sent,s=n.data,"success"===s.status){r.next=9;break}throw new Error(s.message);case 9:m["a"].fire({icon:"success",title:"成功刪除評論"}),e.$emit("after-delete-comment",t),r.next=18;break;case 13:r.prev=13,r.t0=r["catch"](1),a.isProcessing=!1,m["a"].fire({icon:"error",title:"無法刪除該筆評論，請稍後再試"}),console.log("error: ",r.t0);case 18:case"end":return r.stop()}}),r,null,[[1,13]])})))()}}},_=w,y=(r("6887"),Object(p["a"])(_,g,h,!1,null,"25965558",null)),R=y.exports,O=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("form",{on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[r("div",{staticClass:"mb-4"},[r("label",{staticClass:"mb-2",attrs:{for:"text"}},[t._v("留下評論：")]),r("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.text,expression:"text",modifiers:{trim:!0}}],staticClass:"form-control",attrs:{rows:"3",name:"text"},domProps:{value:t.text},on:{input:function(e){e.target.composing||(t.text=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]),r("div",{staticClass:"d-flex align-items-center justify-content-between"},[r("button",{staticClass:"btn btn-link",attrs:{type:"button"},on:{click:function(e){return t.$router.back()}}},[t._v(" 回上一頁 ")]),r("button",{staticClass:"btn btn-primary me-0",attrs:{type:"submit",disabled:t.isProcessing}},[t._v(" "+t._s(t.isProcessing?"Updating...":"Submit")+" ")])])])},j=[],I=(r("a9e3"),{props:{restaurantId:{type:Number,required:!0}},data:function(){return{text:"",isProcessing:!1}},methods:{handleSubmit:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,t.text.length){e.next=4;break}return m["a"].fire({icon:"warning",title:"請輸入評論"}),e.abrupt("return");case 4:return t.isProcessing=!0,e.next=7,C.create({text:t.text,restaurantId:t.restaurantId});case 7:if(r=e.sent,a=r.data,"success"===a.status){e.next=11;break}throw new Error(a.message);case 11:t.$emit("after-create-comment",{commentId:a.commentId,restaurantId:t.restaurantId,text:t.text}),t.text="",t.isProcessing=!1,e.next=20;break;case 16:e.prev=16,e.t0=e["catch"](0),t.isProcessing=!1,m["a"].fire({icon:"error",title:"無法新增評論，請稍後再試"});case 20:case"end":return e.stop()}}),e,null,[[0,16]])})))()}}}),F=I,L=(r("baf7"),Object(p["a"])(F,O,j,!1,null,"467d0862",null)),P=L.exports,D=r("c4c3"),S=r("2375"),U={name:"Restaurant",components:{RestaurantDetail:v,RestaurantComments:R,CreateComment:P,Spinner:S["a"]},data:function(){return{restaurant:{id:-1,name:"",tel:"",address:"",openingHours:"",description:"",image:"",categoryId:0,categoryName:"",isFavorited:!1,isLiked:!1},restaurantComments:[],isLoading:!0}},computed:Object(i["a"])({},Object(k["b"])(["currentUser"])),created:function(){var t=this.$route.params.id;this.fetchRestaurant(t)},methods:{fetchRestaurant:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n,s,i,o,c,u,d,l,f,p,b,v;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,e.isLoading=!0,r.next=4,D["a"].getRestaurant({restaurantId:t});case 4:a=r.sent,n=a.data,s=n.restaurant,i=n.isFavorited,o=n.isLiked,c=s.id,u=s.name,d=s.tel,l=s.address,f=s.opening_hours,p=s.description,b=s.image,v=s.CategoryId,e.restaurant={id:c,name:u,tel:d,address:l,openingHours:f,description:p,image:b,categoryId:v,categoryName:s.Category.name||"未分類",isFavorited:i,isLiked:o},e.restaurantComments=s.Comments,e.isLoading=!1,r.next=17;break;case 13:r.prev=13,r.t0=r["catch"](0),e.isLoading=!1,m["a"].fire({icon:"error",title:"無法讀取餐廳資料，請稍後再試"});case 17:case"end":return r.stop()}}),r,null,[[0,13]])})))()},afterDeleteComment:function(t){this.restaurantComments=this.restaurantComments.filter((function(e){return e.id!==t}))},afterCreateComment:function(t){var e=t.commentId,r=t.restaurantId,a=t.text;this.restaurantComments.push({id:e,RestaurantId:r,text:a,User:{id:this.currentUser.id,name:this.currentUser.name},createdAt:new Date})}},beforeRouteUpdate:function(t,e,r){var a=t.params.id;this.fetchRestaurant(a),r()}},$=U,E=Object(p["a"])($,a,n,!1,null,null,null);e["default"]=E.exports},b51f:function(t,e,r){},baf7:function(t,e,r){"use strict";r("c89c")},c89c:function(t,e,r){},d81d:function(t,e,r){"use strict";var a=r("23e7"),n=r("b727").map,s=r("1dde"),i=s("map");a({target:"Array",proto:!0,forced:!i},{map:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})},e01a:function(t,e,r){"use strict";var a=r("23e7"),n=r("83ab"),s=r("da84"),i=r("e330"),o=r("1a2d"),c=r("1626"),u=r("3a9b"),d=r("577e"),m=r("9bf2").f,l=r("e893"),f=s.Symbol,p=f&&f.prototype;if(n&&c(f)&&(!("description"in p)||void 0!==f().description)){var b={},v=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:d(arguments[0]),e=u(p,this)?new f(t):void 0===t?f():f(t);return""===t&&(b[e]=!0),e};l(v,f),v.prototype=p,p.constructor=v;var g="Symbol(test)"==String(f("test")),h=i(p.toString),x=i(p.valueOf),k=/^Symbol\((.*)\)[^)]+$/,C=i("".replace),w=i("".slice);m(p,"description",{configurable:!0,get:function(){var t=x(this),e=h(t);if(o(b,t))return"";var r=g?w(e,7,-1):C(e,k,"$1");return""===r?void 0:r}}),a({global:!0,forced:!0},{Symbol:v})}},e09a:function(t,e,r){"use strict";r("b51f")}}]);
//# sourceMappingURL=chunk-0991fea9.65509763.js.map